#!/bin/sh

# vim: filetype=dmenu
#  ____  __  __ _____ _   _ _   _    __        ______
# |  _ \|  \/  | ____| \ | | | | |   \ \      / / ___|
# | | | | |\/| |  _| |  \| | | | |____\ \ /\ / / |  _
# | |_| | |  | | |___| |\  | |_| |_____\ V  V /| |_| |
# |____/|_|  |_|_____|_| \_|\___/       \_/\_/  \____|
#
# –°–∫—Ä–∏–ø—Ç –ø–æ–∫–ª—é—á–µ–Ω–∏—è –∫ VPN —Å–µ—Ä–≤–µ—Ä–∞–º
# –ù–∞–ø–∏—Å–∞–Ω: @alexandrovich.ff
# –í–µ–±-—Å–∞–π—Ç: http://malikov.red

keys=$(for conf in `find $HOME/.wg*/* -type f -name "*.conf"`; do printf $conf | cut -f5 -d/ ; done)
process=$(::ifrunning wg)

if [ $? != 0 ] ;
then
    wg=$(sudo -A wg show | grep interface | cut -d' ' -f2)
    [ "$(printf "–ù–µ—Ç\\n–î–∞" | ::dmenu -x 15 -y 40 -h 28 -w 1000 -i -p "–û—Ç–∫–ª—é—á–∏—Ç—Å—è –æ—Ç WG —Å–µ—Ä–≤–µ—Ä–∞?")" = "–î–∞" ] && sudo -A wg-quick down "$HOME/.wg/$wg.conf" && notify-send "üí° –û—Ç–∫–ª—é—á–µ–Ω –æ—Ç WG —Å–µ—Ä–≤–µ—Ä–∞"
else
    ::ifinstalled wg-quick || exit
    wg=$(printf "$keys" | ::dmenu -x 15 -y 40 -h 28 -w 600 -l 10 -i -p "–í—ã–±–µ—Ä–∏—Ç–µ WG —Å–µ—Ä–≤–µ—Ä ÔÇÑ:" )
    [ "$(sudo -A wg-quick up "$HOME/.wg/$wg")" ] & notify-send "üí° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WG —Å–µ—Ä–≤–µ—Ä—É"
fi

sleep 3 && pkill -RTMIN+10 i3blocks
