#!/bin/sh

# vim: filetype=dmenu
#  ____  __  __ _____ _   _ _   _    __     ______  _   _ 
# |  _ \|  \/  | ____| \ | | | | |   \ \   / /  _ \| \ | |
# | | | | |\/| |  _| |  \| | | | |____\ \ / /| |_) |  \| |
# | |_| | |  | | |___| |\  | |_| |_____\ V / |  __/| |\  |
# |____/|_|  |_|_____|_| \_|\___/       \_/  |_|   |_| \_|
#
# –°–∫—Ä–∏–ø—Ç –ø–æ–∫–ª—é—á–µ–Ω–∏—è –∫ VPN —Å–µ—Ä–≤–µ—Ä–∞–º
# –ù–∞–ø–∏—Å–∞–Ω: @alexandrovich.ff
# Website: http://malikov.red

if pgrep -x openvpn >/dev/null ;
then
    [ "$(printf "–ù–µ—Ç\\n–î–∞" | ::dmenu -x 15 -y 40 -h 28 -w 1000 -i -p "–û—Ç–∫–ª—é—á–∏—Ç—Å—è –æ—Ç VPN —Å–µ—Ä–≤–µ—Ä–∞?")" = "–î–∞" ] && sudo -A killall openvpn && notify-send "üí° –û—Ç–∫–ª—é—á–µ–Ω –æ—Ç VPN —Å–µ—Ä–≤–µ—Ä–∞"
else
    keys=$(for ovpn in `find $HOME/.vpn*/* -type f -name "*.ovpn"`; do echo $ovpn | cut -f5 -d/ ; done)
    ovpn=$(printf "$keys" | ::dmenu -x 15 -y 40 -h 28 -w 600 -l 10 -i -p "–í—ã–±–µ—Ä–∏—Ç–µ VPN —Å–µ—Ä–≤–µ—Ä ÔÇÑ:")
    connect=$(sudo -A openvpn --config "$HOME/.vpn/$ovpn")
    $connect
fi

pkill -RTMIN+10 i3blocks