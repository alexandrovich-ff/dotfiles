#!/bin/sh

# vim: filetype=dmenu
#  ____  __  __ _____ _   _ _   _    __     ______  _   _ 
# |  _ \|  \/  | ____| \ | | | | |   \ \   / /  _ \| \ | |
# | | | | |\/| |  _| |  \| | | | |____\ \ / /| |_) |  \| |
# | |_| | |  | | |___| |\  | |_| |_____\ V / |  __/| |\  |
# |____/|_|  |_|_____|_| \_|\___/       \_/  |_|   |_| \_|
#
# –°–∫—Ä–∏–ø—Ç –ø–æ–∫–ª—é—á–µ–Ω–∏—è –∫ VPN —Å–µ—Ä–≤–µ—Ä–∞–º
# –ù–∞–ø–∏—Å–∞–Ω: @alexandrovich.ff
# –í–µ–±-—Å–∞–π—Ç: http://malikov.red

keys=$(for ovpn in `find $HOME/.ovpn*/* -type f -name "*.ovpn"`; do printf $ovpn | cut -f5 -d/ ; done)

if pgrep -x openvpn >/dev/null ;
then
    [ "$(printf "–ù–µ—Ç\\n–î–∞" | ::dmenu -x 15 -y 40 -h 28 -w 1000 -i -p "–û—Ç–∫–ª—é—á–∏—Ç—Å—è –æ—Ç OVPN —Å–µ—Ä–≤–µ—Ä–∞?")" = "–î–∞" ] && sudo -A killall openvpn && notify-send "üí° –û—Ç–∫–ª—é—á–µ–Ω –æ—Ç OVPN —Å–µ—Ä–≤–µ—Ä–∞"
else
    ::ifinstalled openvpn || exit
    ovpn=$(printf "$keys" | ::dmenu -x 15 -y 40 -h 28 -w 600 -l 10 -i -p "–í—ã–±–µ—Ä–∏—Ç–µ OVPN —Å–µ—Ä–≤–µ—Ä ÔÇÑ:" )
    [ "$(sudo -A openvpn --daemon --config "$HOME/.ovpn/$ovpn")" ] & notify-send "üí° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OVPN —Å–µ—Ä–≤–µ—Ä—É"
fi

sleep 3 && pkill -RTMIN+10 i3blocks